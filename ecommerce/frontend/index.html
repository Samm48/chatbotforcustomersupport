<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopSmart - AI E-Commerce</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .header { background: #007bff; color: white; padding: 30px; text-align: center; }
        .products { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 30px; max-width: 1200px; margin: 0 auto; }
        .product-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        .price { color: #007bff; font-size: 1.5rem; font-weight: bold; margin: 10px 0; }
        .btn { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px; }
        .footer { background: #333; color: white; text-align: center; padding: 20px; margin-top: 40px; }
        .chat-btn { position: fixed; bottom: 20px; right: 20px; background: #007bff; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 24px; cursor: pointer; }
        .loading { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõçÔ∏è ShopSmart</h1>
        <p>AI-Powered E-Commerce Platform</p>
        <small id="backend-status">Connecting to backend...</small>
    </div>

    <div class="products" id="products">
        <div class="loading" id="loading">
            Loading products from backend...
            <div style="margin-top: 20px;">
                <button id="retry-btn" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px;">
                    Click to Load Products
                </button>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>¬© 2024 ShopSmart. All rights reserved.</p>
    </div>

    <button class="chat-btn" id="chat-btn">üí¨</button>

    <script>
        // USE YOUR ACTUAL BACKEND URL HERE
        const BACKEND_URL = "https://ecommerce-backend.onrender.com";
        
        // DOM Elements
        const backendStatus = document.getElementById('backend-status');
        const productsDiv = document.getElementById('products');
        const loadingDiv = document.getElementById('loading');
        const retryBtn = document.getElementById('retry-btn');
        const chatBtn = document.getElementById('chat-btn');
        
        // Update status display
        backendStatus.textContent = `Backend: ${BACKEND_URL}`;
        
        // Test backend connection
        async function testBackend() {
            try {
                console.log('Testing backend at:', BACKEND_URL);
                const response = await fetch(`${BACKEND_URL}/api/health`);
                const data = await response.json();
                console.log('Backend response:', data);
                backendStatus.textContent = `‚úÖ Backend Connected: ${BACKEND_URL}`;
                backendStatus.style.color = 'lightgreen';
                return true;
            } catch (error) {
                console.error('Backend test failed:', error);
                backendStatus.textContent = `‚ùå Backend Error: ${BACKEND_URL}`;
                backendStatus.style.color = 'orange';
                return false;
            }
        }

        // Fetch products from backend
        async function loadProducts() {
            loadingDiv.innerHTML = 'Loading products...';
            
            try {
                // First test backend
                const isBackendWorking = await testBackend();
                
                if (!isBackendWorking) {
                    throw new Error('Backend not responding');
                }
                
                console.log('Fetching products from:', `${BACKEND_URL}/api/products`);
                const response = await fetch(`${BACKEND_URL}/api/products`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Products received:', data);
                
                productsDiv.innerHTML = '';
                
                if (data.products && data.products.length > 0) {
                    data.products.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'product-card';
                        productCard.innerHTML = `
                            <h3>${product.name}</h3>
                            <p class="price">$${product.price}</p>
                            <p>${product.category || 'General'}</p>
                            <button class="btn">Add to Cart</button>
                        `;
                        productsDiv.appendChild(productCard);
                    });
                } else {
                    showDemoProducts();
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showDemoProducts(error.message);
            }
        }

        function showDemoProducts(errorMessage = '') {
            productsDiv.innerHTML = '';
            
            const errorContainer = document.createElement('div');
            errorContainer.className = 'loading';
            errorContainer.style.gridColumn = '1/-1';
            
            if (errorMessage) {
                errorContainer.innerHTML = `
                    <h3>‚ö†Ô∏è Could not connect to backend</h3>
                    <p>Error: ${errorMessage}</p>
                    <p>Using demo products instead:</p>
                `;
            } else {
                errorContainer.innerHTML = `<h3>No products found in database</h3><p>Using demo products instead:</p>`;
            }
            
            productsDiv.appendChild(errorContainer);
            
            // Add demo products
            const demoProducts = [
                { id: 1, name: 'Wireless Headphones', price: 199.99, category: 'Electronics' },
                { id: 2, name: 'Smart Watch', price: 299.99, category: 'Electronics' },
                { id: 3, name: 'Running Shoes', price: 89.99, category: 'Sports' },
                { id: 4, name: 'Coffee Maker', price: 149.99, category: 'Home' }
            ];
            
            demoProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <h3>${product.name}</h3>
                    <p class="price">$${product.price}</p>
                    <p>${product.category}</p>
                    <button class="btn">Add to Cart</button>
                `;
                productsDiv.appendChild(productCard);
            });
            
            // Add retry button
            const retryContainer = document.createElement('div');
            retryContainer.style.marginTop = '20px';
            retryContainer.innerHTML = `
                <button style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px;">
                    Retry Connection
                </button>
            `;
            productsDiv.appendChild(retryContainer);
        }

        function addToCart(productId) {
            alert(`Added product ${productId} to cart!`);
        }

        function openChat() {
            alert("AI Chatbot coming soon!\n\nBackend URL: " + BACKEND_URL + 
                  "\n\nTest these endpoints:\n" +
                  "1. " + BACKEND_URL + "/api/health\n" +
                  "2. " + BACKEND_URL + "/api/products\n" +
                  "3. " + BACKEND_URL + "/api/auth/login");
        }

        // Event Listeners
        retryBtn.addEventListener('click', loadProducts);
        chatBtn.addEventListener('click', openChat);

        // Load products when page loads
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, testing backend...');
            loadProducts();
        });
    </script>
</body>
</html>