<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopSmart - AI E-Commerce</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .header { background: #007bff; color: white; padding: 30px; text-align: center; }
        .products { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 30px; max-width: 1200px; margin: 0 auto; }
        .product-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        .price { color: #007bff; font-size: 1.5rem; font-weight: bold; margin: 10px 0; }
        .btn { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px; }
        .footer { background: #333; color: white; text-align: center; padding: 20px; margin-top: 40px; }
        .chat-btn { position: fixed; bottom: 20px; right: 20px; background: #007bff; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 24px; cursor: pointer; }
        .loading { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõçÔ∏è ShopSmart</h1>
        <p>AI-Powered E-Commerce Platform</p>
        <small id="backend-status">Connecting to backend...</small>
    </div>

    <div class="products" id="products">
        <div class="loading" id="loading">
            Loading products from backend...
            <div style="margin-top: 20px;">
                <button id="retry-btn" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px;">
                    Click to Load Products
                </button>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>¬© 2024 ShopSmart. All rights reserved.</p>
    </div>

    <!-- Chatbot HTML added after the footer -->
    <div id="chatbot-modal" style="display: none; position: fixed; bottom: 90px; right: 20px; width: 350px; background: white; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 1000;">
        <div style="background: #007bff; color: white; padding: 15px; border-radius: 10px 10px 0 0; display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0;">ü§ñ AI Shopping Assistant</h3>
            <button id="close-chat" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">√ó</button>
        </div>
        
        <div id="chat-messages" style="height: 300px; overflow-y: auto; padding: 15px;">
            <div class="message bot" style="background: #f1f1f1; padding: 10px; border-radius: 10px; margin-bottom: 10px; max-width: 80%;">
                Hello! I'm your AI shopping assistant. How can I help you today?
            </div>
        </div>
        
        <div style="padding: 15px; border-top: 1px solid #eee;">
            <div style="display: flex; gap: 10px;">
                <input type="text" id="chat-input" placeholder="Type your message..." 
                       style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px;">
                <button id="send-chat" style="background: #007bff; color: white; border: none; border-radius: 20px; padding: 0 20px; cursor: pointer;">
                    Send
                </button>
            </div>
            <div style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;">
                <button class="quick-question" data-question="What products do you have?" style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 15px; padding: 5px 10px; font-size: 12px; cursor: pointer;">
                    What products?
                </button>
                <button class="quick-question" data-question="How do I track my order?" style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 15px; padding: 5px 10px; font-size: 12px; cursor: pointer;">
                    Track order
                </button>
                <button class="quick-question" data-question="What is your shipping policy?" style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 15px; padding: 5px 10px; font-size: 12px; cursor: pointer;">
                    Shipping info
                </button>
                <button class="quick-question" data-question="How do I return an item?" style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 15px; padding: 5px 10px; font-size: 12px; cursor: pointer;">
                    Returns
                </button>
            </div>
        </div>
    </div>

    <button class="chat-btn" id="chat-btn">üí¨</button>

    <script>
        // USE YOUR ACTUAL BACKEND URL HERE
        const BACKEND_URL = "https://ecommerce-backend.onrender.com";
        
        // DOM Elements
        const backendStatus = document.getElementById('backend-status');
        const productsDiv = document.getElementById('products');
        const loadingDiv = document.getElementById('loading');
        const retryBtn = document.getElementById('retry-btn');
        const chatBtn = document.getElementById('chat-btn');
        
        // Update status display
        backendStatus.textContent = `Backend: ${BACKEND_URL}`;
        
        // Test backend connection
        async function testBackend() {
            try {
                console.log('Testing backend at:', BACKEND_URL);
                const response = await fetch(`${BACKEND_URL}/api/health`);
                const data = await response.json();
                console.log('Backend response:', data);
                backendStatus.textContent = `‚úÖ Backend Connected: ${BACKEND_URL}`;
                backendStatus.style.color = 'lightgreen';
                return true;
            } catch (error) {
                console.error('Backend test failed:', error);
                backendStatus.textContent = `‚ùå Backend Error: ${BACKEND_URL}`;
                backendStatus.style.color = 'orange';
                return false;
            }
        }

        // Fetch products from backend
        async function loadProducts() {
            loadingDiv.innerHTML = 'Loading products...';
            
            try {
                // First test backend
                const isBackendWorking = await testBackend();
                
                if (!isBackendWorking) {
                    throw new Error('Backend not responding');
                }
                
                console.log('Fetching products from:', `${BACKEND_URL}/api/products`);
                const response = await fetch(`${BACKEND_URL}/api/products`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Products received:', data);
                
                productsDiv.innerHTML = '';
                
                if (data.products && data.products.length > 0) {
                    data.products.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'product-card';
                        productCard.innerHTML = `
                            <h3>${product.name}</h3>
                            <p class="price">$${product.price}</p>
                            <p>${product.category || 'General'}</p>
                            <button class="btn">Add to Cart</button>
                        `;
                        productsDiv.appendChild(productCard);
                    });
                } else {
                    showDemoProducts();
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showDemoProducts(error.message);
            }
        }

        function showDemoProducts(errorMessage = '') {
            productsDiv.innerHTML = '';
            
            const errorContainer = document.createElement('div');
            errorContainer.className = 'loading';
            errorContainer.style.gridColumn = '1/-1';
            
            if (errorMessage) {
                errorContainer.innerHTML = `
                    <h3>‚ö†Ô∏è Could not connect to backend</h3>
                    <p>Error: ${errorMessage}</p>
                    <p>Using demo products instead:</p>
                `;
            } else {
                errorContainer.innerHTML = `<h3>No products found in database</h3><p>Using demo products instead:</p>`;
            }
            
            productsDiv.appendChild(errorContainer);
            
            // Add demo products
            const demoProducts = [
                { id: 1, name: 'Wireless Headphones', price: 199.99, category: 'Electronics' },
                { id: 2, name: 'Smart Watch', price: 299.99, category: 'Electronics' },
                { id: 3, name: 'Running Shoes', price: 89.99, category: 'Sports' },
                { id: 4, name: 'Coffee Maker', price: 149.99, category: 'Home' }
            ];
            
            demoProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <h3>${product.name}</h3>
                    <p class="price">$${product.price}</p>
                    <p>${product.category}</p>
                    <button class="btn">Add to Cart</button>
                `;
                productsDiv.appendChild(productCard);
            });
            
            // Add retry button
            const retryContainer = document.createElement('div');
            retryContainer.style.marginTop = '20px';
            retryContainer.innerHTML = `
                <button style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px;">
                    Retry Connection
                </button>
            `;
            productsDiv.appendChild(retryContainer);
        }

        function addToCart(productId) {
            alert(`Added product ${productId} to cart!`);
        }

        // ========== CHATBOT FUNCTIONALITY ==========
        let isChatOpen = false;
        const chatbotModal = document.getElementById('chatbot-modal');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendChatBtn = document.getElementById('send-chat');
        const closeChatBtn = document.getElementById('close-chat');

        // AI Responses
        const aiResponses = {
            'product': "We have a wide range of products including electronics, sports gear, home appliances, and accessories. You can browse all products on this page!",
            'order': "To track your order, please check your account dashboard or contact support with your order number.",
            'shipping': "We offer free shipping on orders over $50. Standard delivery takes 3-5 business days. Express shipping is available for $15.",
            'return': "We have a 30-day return policy. Items must be in original condition with tags. Start returns from your order history.",
            'price': "Our prices are competitive and we offer regular discounts. Check our promotions page for current offers!",
            'payment': "We accept all major credit cards, PayPal, and Apple Pay. All payments are secure.",
            'default': "I'm here to help with products, orders, shipping, returns, and general questions. What would you like to know?"
        };

        // Toggle chat window
        chatBtn.addEventListener('click', function() {
            isChatOpen = !isChatOpen;
            chatbotModal.style.display = isChatOpen ? 'block' : 'none';
            if (isChatOpen) {
                chatInput.focus();
            }
        });

        // Close chat
        closeChatBtn.addEventListener('click', function() {
            isChatOpen = false;
            chatbotModal.style.display = 'none';
        });

        // Send message
        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            chatInput.value = '';
            
            // Generate AI response
            setTimeout(() => {
                const aiResponse = generateAIResponse(message);
                addMessage(aiResponse, 'bot');
            }, 500);
        }

        // Generate AI response
        function generateAIResponse(message) {
            const msg = message.toLowerCase();
            
            if (msg.includes('product') || msg.includes('item') || msg.includes('buy')) {
                return aiResponses.product;
            } else if (msg.includes('order') || msg.includes('track') || msg.includes('delivery')) {
                return aiResponses.order;
            } else if (msg.includes('shipping') || msg.includes('deliver') || msg.includes('arrive')) {
                return aiResponses.shipping;
            } else if (msg.includes('return') || msg.includes('refund') || msg.includes('exchange')) {
                return aiResponses.return;
            } else if (msg.includes('price') || msg.includes('cost') || msg.includes('expensive')) {
                return aiResponses.price;
            } else if (msg.includes('payment') || msg.includes('pay') || msg.includes('card')) {
                return aiResponses.payment;
            } else if (msg.includes('hello') || msg.includes('hi') || msg.includes('hey')) {
                return "Hello! I'm your AI shopping assistant. How can I help you today?";
            } else {
                return aiResponses.default;
            }
        }

        // Add message to chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.style.background = sender === 'user' ? '#007bff' : '#f1f1f1';
            messageDiv.style.color = sender === 'user' ? 'white' : 'black';
            messageDiv.style.padding = '10px';
            messageDiv.style.borderRadius = '10px';
            messageDiv.style.marginBottom = '10px';
            messageDiv.style.maxWidth = '80%';
            messageDiv.style.marginLeft = sender === 'user' ? 'auto' : '0';
            messageDiv.textContent = text;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Event listeners
        sendChatBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });

        // Quick question buttons
        document.querySelectorAll('.quick-question').forEach(button => {
            button.addEventListener('click', function() {
                const question = this.getAttribute('data-question');
                chatInput.value = question;
                sendMessage();
            });
        });

        // Remove old openChat function since we have the new chatbot
        // Event Listeners
        retryBtn.addEventListener('click', loadProducts);
        
        // Load products when page loads
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, testing backend...');
            loadProducts();
        });
    </script>
    
</body>
</html>